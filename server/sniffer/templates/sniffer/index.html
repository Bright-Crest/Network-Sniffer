{% extends 'base.html' %}

{% load static %}

{% block style %}

{% endblock %}

{% block content %}
  <div class="container mt-3">
    <h1>欢迎使用网络嗅探器</h1>

    <div>
      <div>
        <form id="sseForm" name="sseForm" method="post" novalidate>
          {% csrf_token %}
          <input type="hidden" name="sseData" value="start" />
          <button id="sseStart" class="btn btn-outline-primary" type="submit">开始嗅探</button>
        </form>
      </div>
    </div>

    <div class="mt-5 mb-5">
      <h3>已检测到的可被嗅探的客户端</h3>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>IP</th>
            <th>端口</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody class="table-group-divider">
          {% for sse_client in sse_clients %}
            <tr>
              <td>{{ sse_client.ip }}</td>
              <td>{{ sse_client.port }}</td>
              <td>TODO</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="mt-4 mb-5">
      <h3>正在进行的嗅探器</h3>
      <h6 class="text-secondary">没有被停止</h6>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>时间</th>
            <th>网卡</th>
            <th>过滤条件</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody class="table-group-divider">
          {% for sniff_history in sniff_historys %}
            {% if sniff_history.is_history is False and sniff_history.is_stopped is False %}
              <tr>
                <td>{{ sniff_history.timestamp }}</td>
                <td>{{ sniff_history.net_card }}</td>
                <td>{{ sniff_history.filter }}</td>
                <td>todo</td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="mt-4 mb-5">
      <h3>已暂停的嗅探器</h3>
      <h6 class="text-secondary">可以在相同的网卡上以相同的过滤条件重新开始嗅探</h6>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>时间</th>
            <th>网卡</th>
            <th>过滤条件</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody class="table-group-divider">
          {% for sniff_history in sniff_historys %}
            {% if sniff_history.is_history is False and sniff_history.is_stopped %}
              <tr>
                <td>{{ sniff_history.timestamp }}</td>
                <td>{{ sniff_history.net_card }}</td>
                <td>{{ sniff_history.filter }}</td>
                <td>todo</td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="mt-4 mb-5">
      <h3>历史记录</h3>
      <h6 class="text-secondary">无法重新开始，只是历史记录而已</h6>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>时间</th>
            <th>网卡</th>
            <th>过滤条件</th>
            <th>操作</th>
          </tr>
        </thead>
        <tbody class="table-group-divider">
          {% for sniff_history in sniff_historys %}
            {% if sniff_history.is_history %}
              <tr>
                <td>{{ sniff_history.timestamp }}</td>
                <td>{{ sniff_history.net_card }}</td>
                <td>{{ sniff_history.filter }}</td>
                <td>todo</td>
              </tr>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
{% endblock %}

{% block script %}
  <script type="text/javascript">
    window.onload = function () {
      // 禁用“确认重新提交表单”
      window.history.replaceState(null, null, window.location.href)
    }
  </script>
{% endblock %}
